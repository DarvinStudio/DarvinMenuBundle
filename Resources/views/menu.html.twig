{% import _self as that %}

{% macro list(item, matcher) %}

    {% import _self as that %}

    <ul>
        {% for child in item.children %}

            {% set classes = [] %}

            {% if matcher.isCurrent(child) or matcher.isAncestor(child) %}

                {% set classes = classes|merge(['current']) %}

            {% endif %}

            <li{% if classes is not empty %} class="{{ classes|join(' ') }}"{% endif %}>
                {% if image_exists(child.extras.image) %}

                    {% set attr = {
                        'src': child.extras.image|image_filter('menu_main'),
                        'alt': child.label,
                    } %}

                    {% if image_exists(child.extras.hoverImage) %}

                        {% set attr = attr|merge({
                            'onmouseover':  'this.src="' ~ child.extras.hoverImage|image_filter('menu_hover') ~ '";',
                            'onmouseleave': 'this.src="' ~ attr.src ~ '";',
                        }) %}

                    {% endif %}

                    <img{% for name, value in attr %} {{ name }}="{{ value }}"{% endfor %}>
                {% endif %}
                {% if child.uri %}
                    <a href="{{ child.uri }}">{{ child.label }}</a>
                {% else %}
                    <span>{{ child.label }}</span>
                {% endif %}
                {% if child.children is not empty %}
                    {{ that.list(child, matcher) }}
                {% endif %}
            </li>
        {% endfor %}
    </ul>
{% endmacro %}

{% if item.children is not empty %}
    <nav>
        {{ that.list(item, matcher) }}
    </nav>
{% endif %}
