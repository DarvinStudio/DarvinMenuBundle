{% import _self as that %}

{% macro list(item, matcher) %}

    {% import _self as that %}

    {% if item.children is not empty %}
        <ul>
            {% for child in item.children %}

                {% set classes = [] %}

                {% if matcher.isCurrent(child) or matcher.isAncestor(child) %}

                    {% set classes = classes|merge(['current']) %}

                {% endif %}

                <li{% if classes is not empty %} class="{{ classes|join(' ') }}"{% endif %}>
                    <img src="{{ child.extras.image|image_filter('menu_main') }}"
                         alt="{{ child.extras.image|image_alt(child.label) }}"
                         title="{{ child.extras.image|image_title(child.label) }}">
                    <img src="{{ child.extras.hoverImage|image_filter('menu_hover') }}"
                         alt="{{ child.extras.hoverImage|image_alt(child.label) }}"
                         title="{{ child.extras.hoverImage|image_title(child.label) }}">
                    {% if child.uri %}
                        <a href="{{ child.uri }}">{{ child.label }}</a>
                    {% else %}
                        <span>{{ child.label }}</span>
                    {% endif %}
                    {{ that.list(child, matcher) }}
                </li>
            {% endfor %}
        </ul>
    {% endif %}
{% endmacro %}

{% if item.children is not empty %}
    <nav>
        {{ that.list(item, matcher) }}
    </nav>
{% endif %}
